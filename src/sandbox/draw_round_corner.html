<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="data:," />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Draw corner</title>
  </head>
  <body>
    <div id="root" style="position: relative"></div>
    <script type="module" jsenv-type="module/jsx">
      import { render } from "preact";
      import { useRef, useLayoutEffect } from "preact/hooks";
      import { useLocalStorageState } from "/app/hooks/use_local_storage_state.js";
      import { drawArc } from "/app/canvas/draw.js";

      // eslint-disable-next-line no-unused-vars
      const App = () => {
        const canvasRef = useRef();

        const [x, xSetter] = useLocalStorageState("x", 50);
        const [y, ySetter] = useLocalStorageState("y", 25);
        const [outerSize, outerSizeSetter] = useLocalStorageState(
          "outer_size",
          1,
        );
        const [innerSize, innerSizeSetter] = useLocalStorageState(
          "inner_size",
          1,
        );
        const [radius, radiusSetter] = useLocalStorageState("radius", 10);
        const [topLeft, topLeftSetter] = useLocalStorageState("topLeft", true);
        const [topRight, topRightSetter] = useLocalStorageState(
          "topRight",
          true,
        );
        const [bottomRight, bottomRightSetter] = useLocalStorageState(
          "bottomRight",
          true,
        );
        const [bottomLeft, bottomLeftSetter] = useLocalStorageState(
          "bottomLeft",
          true,
        );

        const drawArcs = (canvas) => {
          const context = canvas.getContext("2d");
          context.clearRect(0, 0, canvas.width, canvas.height);
          const outerColor = "green";
          const opacity = 0.8;
          const innerColor = "red";
          const innerOpacity = 0.7;
          let innerRadius = radius - outerSize / 2 - innerSize / 2;
          if (innerRadius < 0) {
            innerRadius = 0;
          }

          if (topLeft) {
            drawTopLeftArc(context, {
              x,
              y,
              radius,
              size: outerSize,
              color: outerColor,
              opacity,
            });
            drawTopLeftArc(context, {
              x: x + outerSize,
              y: y + outerSize,
              radius: innerRadius,
              size: innerSize,
              color: innerColor,
              opacity: innerOpacity,
            });
          }
        };

        const drawTopLeftArc = (
          context,
          { x, y, radius, size, color, opacity = 1 },
        ) => {
          context.lineWidth = size;
          context.globalAlpha = opacity;
          const center = [x + radius + size / 2, y + radius + size / 2];
          drawArc(context, center, radius, 180, 270, {
            color,
          });
        };

        useLayoutEffect(() => {
          drawArcs(canvasRef.current);
        }, [
          x,
          y,
          outerSize,
          innerSize,
          radius,
          topLeft,
          topRight,
          bottomRight,
          bottomLeft,
        ]);

        return (
          <div>
            <canvas ref={canvasRef} width="100" height="100"></canvas>
            <fieldset>
              <legend>General</legend>

              <label>
                x:
                <input
                  type="number"
                  min="0"
                  max="100"
                  value={x}
                  onInput={(e) => {
                    if (!isNaN(e.target.valueAsNumber)) {
                      xSetter(e.target.valueAsNumber);
                    }
                  }}
                />
              </label>
              <label>
                y:
                <input
                  type="number"
                  min="0"
                  max="100"
                  value={y}
                  onInput={(e) => {
                    if (!isNaN(e.target.valueAsNumber)) {
                      ySetter(e.target.valueAsNumber);
                    }
                  }}
                />
              </label>
              <br />
              <label>
                radius:
                <input
                  type="number"
                  min="1"
                  max="100"
                  value={radius}
                  onInput={(e) => radiusSetter(e.target.valueAsNumber)}
                />
              </label>
              <br />
              <label>
                top left:
                <input
                  type="checkbox"
                  checked={topLeft}
                  onChange={(e) => topLeftSetter(e.target.checked)}
                />
              </label>
              <label>
                top right:
                <input
                  type="checkbox"
                  checked={topRight}
                  onChange={(e) => topRightSetter(e.target.checked)}
                />
              </label>
              <label>
                bottom right:
                <input
                  type="checkbox"
                  checked={bottomRight}
                  onChange={(e) => bottomRightSetter(e.target.checked)}
                />
              </label>
              <label>
                bottom left:
                <input
                  type="checkbox"
                  checked={bottomLeft}
                  onChange={(e) => bottomLeftSetter(e.target.checked)}
                />
              </label>
            </fieldset>
            <fieldset>
              <legend>Outer</legend>
              <label>
                size:
                <input
                  type="number"
                  min="1"
                  max="100"
                  value={outerSize}
                  onInput={(e) => outerSizeSetter(e.target.valueAsNumber)}
                />
              </label>
            </fieldset>
            <fieldset>
              <legend>Inner</legend>
              <label>
                size:
                <input
                  type="number"
                  min="1"
                  max="100"
                  value={innerSize}
                  onInput={(e) => innerSizeSetter(e.target.valueAsNumber)}
                />
              </label>
            </fieldset>
          </div>
        );
      };

      render(<App />, document.querySelector("#root"));
    </script>
  </body>
</html>
