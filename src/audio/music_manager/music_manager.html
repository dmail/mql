<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="data:," />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Music manager</title>
  </head>
  <body>
    <div id="root" style="position: relative"></div>
    <script type="module" jsenv-type="module/jsx">
      import { render } from "preact";
      import { music } from "../audio.js";
      import { useVolume, useMuted, usePlaybackState } from "../audio_hooks.js";
      import {
        mute,
        unmute,
        mutedSignal,
        audioPausedSignal,
        play,
        pause,
      } from "../audio_signals.js";

      const musicA = music({
        url: import.meta.resolve("./sky.mp3"),
      });
      const musicB = music({
        url: import.meta.resolve("./sky.mp3"),
      });

      // eslint-disable-next-line no-unused-vars
      const Music = ({ name, music }) => {
        const volume = useVolume(music);
        const muted = useMuted(music);
        const playbackState = usePlaybackState(music);

        return (
          <fieldset>
            <legend>
              <h2 style="margin:0">{name}</h2>
            </legend>
            <div>
              volume:
              <progress min="0" max="1" value={volume}>
                {volume}
              </progress>
            </div>
            <div style="margin-top: 10px">
              <button
                disabled={muted}
                onClick={() => {
                  music.mute();
                }}
              >
                mute
              </button>
              <button
                disabled={!muted}
                onClick={() => {
                  music.unmute();
                }}
              >
                unmute
              </button>
            </div>
            <div style="margin-top: 10px">
              <button
                disabled={playbackState === "playing"}
                onClick={() => {
                  music.play();
                }}
              >
                play
              </button>
              <button
                disabled={playbackState === "paused"}
                onClick={() => {
                  music.pause();
                }}
              >
                pause
              </button>
            </div>
          </fieldset>
        );
      };

      // eslint-disable-next-line no-unused-vars
      const App = () => {
        return (
          <div>
            <h1>Music Manager</h1>

            <div style="display:flex; flex-direction: column; margin: 10px;">
              <h3>Global controls</h3>
              <div>
                <button
                  onClick={() => {
                    if (mutedSignal.value) {
                      unmute();
                    } else {
                      mute();
                    }
                  }}
                >
                  {mutedSignal.value ? "unmute all" : "mute all"}
                </button>
                <button
                  onClick={() => {
                    if (audioPausedSignal.value) {
                      play();
                    } else {
                      pause();
                    }
                  }}
                >
                  {audioPausedSignal.value ? "pause all" : "play all"}
                </button>
              </div>
            </div>

            <div style="display: flex; gap: 10px">
              <Music name="a" music={musicA} />
              <Music name="b" music={musicB} />
            </div>
          </div>
        );
      };

      render(<App />, document.getElementById("root"));
    </script>
  </body>
</html>
